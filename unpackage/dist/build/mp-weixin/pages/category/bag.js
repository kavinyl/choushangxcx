"use strict";var e=require("../../common/vendor.js");const t={data:()=>({getData:[],bagList:[],curList:[],classAll:[],classAllBtn:!1,hasConditions:!1,timeImg:["https://xcxcs.obs.cn-east-3.myhuaweicloud.com/images/category/default.png","https://xcxcs.obs.cn-east-3.myhuaweicloud.com/images/category/up.png","https://xcxcs.obs.cn-east-3.myhuaweicloud.com/images/category/down.png"],doSelect:!1,small:!1,timeIndex:0,update:!0,controlShow:!1,selectAll:!1,changeArr:[],token:"",totalPage:1}),onShow(){e.index.getStorage({key:"token",success:e=>{this.token=e.data,this.getJson()},fail:t=>{e.index.showToast({title:"请先登录",icon:"none"}),setTimeout((function(){e.index.switchTab({url:"/pages/user"})}),1e3)}})},methods:{getJson(){e.index.request({url:"http://123.60.71.74:20001/mh/user/product/list",method:"GET",dataType:"JSON",header:{token:this.token},success:e=>{let t=JSON.parse(e.data);this.getData=t.data}})},showAll(){this.$refs.allPros.open()},closeAll(){this.$refs.allPros.close()},classChoose(e,t){e.choose=!e.choose},clickAll(){e.index.redirectTo({url:"/pages/category/bag"})},submit(){var t=[],s=this,o=0;this.classAll.forEach((function(e,s){e.list.forEach((function(e,s){e.list.forEach((function(e,s){o++,e.choose&&t.push(e.class3Code)}))}))})),console.log(t),s.hasConditions=t.length!=o,0==t.length?e.index.showToast({title:"请选择三级分类",icon:"none"}):(console.log("条件",t),console.log(s.getData),s.curList=[],s.bagList.forEach((function(e,o){t.forEach((function(t){e.class3Code==t&&s.curList.push(e)}))})),s.closeAll(),s.forceupdate())},timeSwitch(){var e=this;switch(2==e.timeIndex?(e.timeIndex=0,e.small=!1):(e.timeIndex++,e.small=!0),e.timeIndex){case 1:e.curList.sort((function(e,t){return e.time-t.time}));break;case 2:e.curList.sort((function(e,t){return t.time-e.time}));break;case 0:e.curList.sort((function(e,t){return e.id-t.id}))}},select(){var e=this;e.doSelect=!e.doSelect,e.controlShow=!e.controlShow},selectItem(e){this.doSelect&&!e.isdeal&&(e.choose=!e.choose)},loadClass(){var e=this,t=[];this.bagList.forEach((function(e){20==e.productItemPosition&&t.push(e)}));var s=[];for(let a=0;a<t.length;a++){var o=new Object;o.name=t[a].class1Name,o.class1Code=t[a].class1Code,o.choose=!1,o.class="c1",o.list=[],s.push(o),e.checkRepeat(s);for(let s=0;s<t.length;s++){var c=new Object;c.name=t[s].class2Name,c.class2Code=t[s].class2Code,c.choose=!1,c.class="c2",c.list=[],t[a].class1Code==t[s].class1Code&&o.list.push(c),e.checkRepeat(o.list);for(let o=0;o<t.length;o++){var l=new Object;l.name=t[o].class3Name,l.class3Code=t[o].class3Code,l.class="c3",l.choose=!1,t[s].class2Code==t[o].class2Code&&c.list.push(l),e.checkRepeat(c.list)}}}console.log(s),e.classAll=s},checkRepeat(e){for(let t=0;t<e.length;t++)for(let s=t+1;s<e.length;s++)e[t].name===e[s].name&&(e.splice(s,1),s--)},forceupdate(){this.update=!1,this.update=!0},chooseAll(){var e=this;e.selectAll=!e.selectAll;for(let t=0;t<e.bagList.length;t++)e.bagList[t].choose=!e.bagList[t].isdeal&&e.selectAll},verify(){var t=this;let s=[];for(let e=0;e<t.bagList.length;e++)t.bagList[e].choose&&s.push(t.bagList[e]);return s.length>0||(e.index.showToast({title:"请选择",icon:"none"}),!1)},goCabinet(){var t=this;if(this.verify()){for(let e=0;e<t.bagList.length;e++)t.bagList[e].choose&&t.changeArr.push(t.bagList[e].userProductCode);console.log(t.changeArr),e.index.request({url:"http://123.60.71.74:20001/mh/user/product/case/in?userProductCodeList="+this.changeArr.join(","),method:"PUT",header:{token:this.token,"Content-Type":"application/x-www-form-urlencoded"},success:e=>{console.log(e),this.$nextTick((function(){t.dataUpdate()}))}}),this.complete()}console.log("放进赏柜",this.changeArr),this.changeArr=[]},goDeal(){var t=this;if(this.verify()){for(let e=0;e<t.curList.length;e++)t.curList[e].choose&&(t.curList[e].isdeal=!0,t.curList[e].choose=!1,t.changeArr.push(t.curList[e]));this.complete(),console.log("发布交易",this.changeArr),e.index.navigateTo({url:"/pages/category/publish"})}this.changeArr=[]},complete(){this.doSelect=!1,this.controlShow=!1,this.selectAll=!1},dataUpdate(){this.getJson(),this.forceupdate()}},mounted(){this.forceupdate()},watch:{getData:function(e,t){console.log("列表更新",e),this.bagList=[],this.bagList=this.bagList.concat(e),this.curList=[],this.curList=this.curList.concat(e),this.loadClass(),this.curList.sort((function(e,t){return e.id-t.id}))}}};if(!Array){e.resolveComponent("uni-drawer")()}Math;var s=e._export_sfc(t,[["render",function(t,s,o,c,l,a){return{a:!l.hasConditions,b:l.hasConditions,c:e.o(((...e)=>a.showAll&&a.showAll(...e))),d:l.small?1:"",e:l.timeImg[l.timeIndex],f:e.o(((...e)=>a.timeSwitch&&a.timeSwitch(...e))),g:!l.doSelect,h:!l.doSelect,i:!l.doSelect,j:l.doSelect,k:e.o(((...e)=>a.select&&a.select(...e))),l:e.f(l.curList,((t,s,o)=>({a:t.imgUrl,b:e.t(t.itemTypeName),c:e.t(t.productItemName),d:l.doSelect&&t.choose&&!t.isdeal,e:t.isdeal,f:s,g:e.o((e=>a.selectItem(t)),s),h:"20"==t.productItemPosition}))),m:l.update,n:e.o(((...e)=>a.clickAll&&a.clickAll(...e))),o:e.f(l.classAll,((t,s,o)=>e.e({a:e.t(t.name),b:!t.choose},(t.choose,{}),{c:t.choose},(t.choose,{}),{d:t.choose?1:"",e:e.o((e=>a.classChoose(t,s))),f:e.f(t.list,((t,s,o)=>e.e({a:e.t(t.name),b:!t.choose},(t.choose,{}),{c:t.choose},(t.choose,{}),{d:t.choose?1:"",e:e.o((e=>a.classChoose(t,s))),f:e.f(t.list,((t,s,o)=>({a:e.t(t.name),b:t.choose?1:"",c:e.o((e=>a.classChoose(t,s))),d:s}))),g:s,h:t.choose?"1000rpx":"80rpx"}))),g:s,h:t.choose?"1000rpx":"80rpx"}))),p:e.o(((...e)=>a.submit&&a.submit(...e))),q:e.sr("allPros","d51de448-0"),r:e.o((e=>a.closeAll())),s:e.p({mode:"left","mask-click":!0}),t:l.selectAll,v:e.o(((...e)=>a.chooseAll&&a.chooseAll(...e))),w:e.o((e=>a.goDeal())),x:e.o((e=>a.goCabinet())),y:l.controlShow}}]]);wx.createPage(s);
