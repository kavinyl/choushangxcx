"use strict";var e=require("../common/vendor.js");const o={data:()=>({isLogin:!1,token:"",code:"",userInfo:""}),onShow(){this.checkToken()},methods:{checkToken(){e.index.request({url:"http://123.60.71.74:20001/wx/mini/user/check",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded",token:e.index.getStorageSync("token")},success:o=>{console.log("token",o),"555"==o.data.code||"556"==o.data.code?(e.index.showToast({title:"登录过期！",icon:"error"}),this.isLogin=!1):(e.index.setStorage({key:"token",data:o.data.data}),this.isLogin=!0,this.userInfo=e.index.getStorageSync("userInfo"))}})},toPage(o){this.isLogin?e.index.navigateTo({url:o}):e.index.showToast({title:"请先登录",icon:"none"})},getUserInfo(){var o=this;e.index.showLoading({title:"加载中"}),e.index.getUserProfile({desc:"登录后可同步数据",success:async t=>{console.log("obj",t),this.userInfo=t.userInfo,e.index.setStorageSync("userInfo",this.userInfo),e.index.login({provider:"weixin",success:t=>{console.log("res-login",t),o.code=t.code,"login:ok"==t.errMsg&&(e.index.request({url:"http://123.60.71.74:20001//wx/mini/user/login/?code="+this.code,data:{code:o.code,nickName:o.userInfo.nickName,avatarUrl:o.userInfo.avatarUrl},method:"POST"}).then((t=>{console.log(t),500==t.data.code?o.getUserInfo():200==t.statusCode&&(o.token=t.data.data,e.index.setStorage({key:"token",data:o.token}),this.isLogin=!0)})),console.log("success"))}})},fail:()=>{e.index.showToast({title:"请重试",icon:"error",mask:!0})},complete:()=>{e.index.hideLoading()}})}},watch:{}};var t=e._export_sfc(o,[["render",function(o,t,s,n,a,i){return e.e({a:!a.isLogin},a.isLogin?{}:{b:e.o(((...e)=>i.getUserInfo&&i.getUserInfo(...e)))},{c:a.isLogin},a.isLogin?{d:a.userInfo.avatarUrl,e:e.t(a.userInfo.nickName)}:{},{f:e.o((e=>i.toPage("/pages/user/fav"))),g:e.o((e=>i.toPage("/pages/user/account"))),h:e.o((e=>i.toPage("/pages/user/history"))),i:e.o((e=>i.toPage("/pages/user/address"))),j:e.o((e=>i.toPage("/pages/user/postcard"))),k:e.o((e=>i.toPage("/pages/about/agreements")))})}]]);wx.createPage(t);
