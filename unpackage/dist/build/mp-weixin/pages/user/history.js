"use strict";var s=require("../../common/vendor.js");const e={data:()=>({hasConditions:!1,timeImg:["https://xcxcs.obs.cn-east-3.myhuaweicloud.com/images/category/default.png","https://xcxcs.obs.cn-east-3.myhuaweicloud.com/images/category/up.png","https://xcxcs.obs.cn-east-3.myhuaweicloud.com/images/category/down.png"],small:!1,timeIndex:0,update:!0,history:[],totalTimes:0,totalQuality:0,allClass:[],classList:[],searchVal:"",orders:[],emptyList:!1,doSearch:!1,searchClass:[],token:"",status:"more",pageNo:1,contentText:{contentdown:"点击展示更多",contentrefresh:"加载中",contentnomore:"没有更多了"},totalPage:1}),onShow(){this.token=s.index.getStorageSync("token"),this.getJson()},methods:{getJson(){s.index.request({url:"http://123.60.71.74:20001/mh/user/lottery/record/page",method:"GET",data:{no:1,size:10},header:{token:this.token},success:s=>{this.history=s.data.data.list,this.orders=this.history,this.totalPage=s.data.data.totalPage}})},getClass(){s.index.request({url:"http://123.60.71.74:20001/mh/product/class/list",method:"GET",success:s=>{this.allClass=s.data.data}})},timeSwitch(){var s=this;switch(2==s.timeIndex?(s.timeIndex=0,s.small=!1):(s.timeIndex++,s.small=!0),this.orders.forEach((s=>{let e=new Date(s.makeTime.replace(/\-/g,"/"));s.makeDate=e.getTime()})),s.timeIndex){case 1:s.orders.sort((function(s,e){return s.makeDate-e.makeDate}));break;case 2:s.orders.sort((function(s,e){return e.makeDate-s.makeDate}));break;case 0:s.orders.sort((function(s,e){return e.orderCode-s.orderCode}))}},forceupdate(){this.update=!1,this.update=!0},showAll(){this.$refs.allClass.open(),this.loadClass()},closeAll(){this.$refs.allClass.close()},classChoose(s,e){s.choose=!s.choose},clickAll(){this.getJson(),this.closeAll(),this.forceupdate(),this.doSearch=!1},submit(){var e=[],o=this,t=0;this.doSearch?o.searchClass.forEach((function(s,o){s.productClass2VoList.forEach((function(s,o){t++,s.choose&&e.push(s.class2Name)}))})):o.allClass.forEach((function(s,o){s.productClass2VoList.forEach((function(s,o){t++,s.choose&&e.push(s.class2Name)}))})),o.hasConditions=e.length!=t,0==e.length?s.index.showToast({title:"请选择二级分类",icon:"none"}):(console.log("条件",e),o.orders=[],o.orders.forEach((function(s,t){e.forEach((function(e,t){s.class2Name==e&&o.orders.push(s)}))})),this.allClass.forEach((function(s,e){s.choose=!1,s.productClass2VoList.forEach((function(s,e){s.choose=!1}))})),o.closeAll(),o.forceupdate(),o.searchVal="")},search(s){var e=this;this.doSearch=!0,this.searchClass=[];var o=0;this.allClass.forEach((function(t,a){t.productClass2VoList.forEach((function(a,c){-1!=a.class2Name.indexOf(s.value)&&(e.searchClass.push({name:t.class1Name,choose:!1,productClass2VoList:[]}),e.searchClass[o].productClass2VoList.push({name:a.class2Name,choose:!1}),console.log(e.searchClass[o]),o++)}))}))},input(s){},clear(s){this.doSearch=!1},loadClass(){var s=this;this.classList=[],this.allClass.forEach((function(e,o){e.productClass2VoList.forEach((function(e,o){s.classList.push(e.class2Name)}))}))},loadMore(e){var o=this;this.pageNo<this.totalPage?(o.pageNo++,this.status="loading",s.index.request({url:"http://123.60.71.74:20001/mh/user/lottery/record/page",method:"GET",header:{token:o.token},data:{no:o.pageNo,size:10},success:s=>{s.data.data.list.forEach((function(s){o.history.push(s),o.orders.push(s)})),o.status="more"}})):this.status="noMore"}},mounted(){},watch:{history:function(s,e){this.getClass()},orders:function(s,e){var o=this;console.log(s),this.totalTimes=s.length,o.totalQuality=0;for(let t=0;t<this.orders.length;t++)o.totalQuality+=o.orders[t].lotteryTimes;this.loadClass()}}};if(!Array){(s.resolveComponent("uni-load-more")+s.resolveComponent("uni-search-bar")+s.resolveComponent("uni-drawer"))()}Math||((()=>"../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar.js")+(()=>"../../uni_modules/uni-drawer/components/uni-drawer/uni-drawer.js"))();var o=s._export_sfc(e,[["render",function(e,o,t,a,c,r){return s.e({a:!c.hasConditions,b:c.hasConditions,c:s.o(((...s)=>r.showAll&&r.showAll(...s))),d:c.small?1:"",e:c.timeImg[c.timeIndex],f:s.o(((...s)=>r.timeSwitch&&r.timeSwitch(...s))),g:s.t(c.totalTimes),h:s.t(c.totalQuality),i:c.emptyList,j:s.f(c.orders,((e,o,t)=>({a:s.t(e.orderCode),b:s.t(e.productName),c:s.t(e.makeTime),d:s.t(e.lotteryTimes),e:s.t(e.price),f:o}))),k:s.o(r.loadMore),l:s.p({status:c.status,contentText:c.contentText}),m:s.o(r.search),n:s.o(r.input),o:s.o(r.clear),p:s.o((s=>c.searchVal=s)),q:s.p({placeholder:"请输入搜索内容",cancelButton:"none",modelValue:c.searchVal}),r:s.o(((...s)=>r.clickAll&&r.clickAll(...s))),s:!c.doSearch},c.doSearch?{}:{t:s.f(c.allClass,((e,o,t)=>s.e({a:s.t(e.class1Name),b:!e.choose},(e.choose,{}),{c:e.choose},(e.choose,{}),{d:e.choose?1:"",e:s.o((s=>r.classChoose(e,o))),f:s.f(e.productClass2VoList,((e,o,t)=>({a:s.t(e.class2Name),b:e.choose?1:"",c:s.o((s=>r.classChoose(e,o))),d:o,e:e.choose?"1000rpx":"80rpx"}))),g:s.t(e.class1Name),h:o,i:e.choose?"1000rpx":"80rpx"})))},{v:c.doSearch},c.doSearch?{w:s.f(c.searchClass,((e,o,t)=>s.e({a:s.t(e.class1Name),b:!e.choose},(e.choose,{}),{c:e.choose},(e.choose,{}),{d:e.choose?1:"",e:s.o((s=>r.classChoose(e,o))),f:s.f(e.productClass2VoList,((e,o,t)=>({a:s.t(e.class2Name),b:e.choose?1:"",c:s.o((s=>r.classChoose(e,o))),d:o,e:e.choose?"1000rpx":"80rpx"}))),g:s.t(e.class1Name),h:o,i:e.choose?"1000rpx":"80rpx"})))}:{},{x:s.o(((...s)=>r.submit&&r.submit(...s))),y:s.sr("allClass","c043b796-1"),z:s.o((s=>r.closeAll())),A:s.p({mode:"left","mask-click":!0})})}]]);wx.createPage(o);
