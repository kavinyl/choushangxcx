"use strict";var e=require("../../common/vendor.js");const t={name:"cabinet",props:{pageIndex:{type:Number,default:0},getData:{type:Object,default:{}},fake:{type:Array,default:[]},totalPage:{type:Number,default:1},token:{type:String,default:""}},data:()=>({items:["全部","现货","预售","单品"],styles:[{value:"button",text:"按钮",checked:!0},{value:"text",text:"文字"}],colors:["#FDA804","#4cd964","#dd524d"],current:0,colorIndex:0,activeColor:"#F9B002",styleType:"text",cabinetList:[],timeIndex:0,timeImg:["https://xcxcs.obs.cn-east-3.myhuaweicloud.com/images/category/default.png","https://xcxcs.obs.cn-east-3.myhuaweicloud.com/images/category/up.png","https://xcxcs.obs.cn-east-3.myhuaweicloud.com/images/category/down.png"],curTime:"",small:!1,update:!0,showBag:!1,doSelect:!1,controlShow:!1,selectAll:!1,changeArr:[],recoverShow:!1,recoverPoint:0,products:0,address:{},addressList:[],applyShip:[],classAll:[],classAllBtn:!1,hasConditions:!1,status:"more",pageNo:1,contentText:{contentdown:"点击展示更多",contentrefresh:"加载中",contentnomore:"没有更多了"},curList:[],msgTitle:"提示",msgContent:"申请发货后不可撤销！",hasPre:!1}),onShow(){this.doSelect=!1},methods:{onClickItem(e){this.current!==e.currentIndex&&(this.current=e.currentIndex)},showAll(){this.$refs.allPros.open()},closeAll(){this.$refs.allPros.close()},classChoose(e,t){e.choose=!e.choose},clickAll(){this.closeAll(),this.$emit("update")},submit(){var t=[],s=this,o=0;this.classAll.forEach((function(e,s){e.list.forEach((function(e,s){e.list.forEach((function(e,s){o++,e.choose&&t.push(e.class3Code)}))}))})),console.log(t),s.hasConditions=t.length!=o,0==t.length?e.index.showToast({title:"请选择三级分类",icon:"none"}):(console.log("条件",t),s.curList=[],s.cabinetList.forEach((function(e,o){t.forEach((function(t){e.class3Code==t&&s.curList.push(e)}))})),s.closeAll(),s.forceupdate())},timeSwitch(){var e=this;switch(2==e.timeIndex?(e.timeIndex=0,e.small=!1):(e.timeIndex++,e.small=!0),this.curList.forEach((e=>{let t=new Date(e.takeTime.replace(/\-/g,"/"));e.takeDate=t.getTime()})),e.timeIndex){case 1:e.curList.sort((function(e,t){return e.takeDate-t.takeDate}));break;case 2:e.curList.sort((function(e,t){return t.takeDate-e.takeDate}));break;case 0:e.curList.sort((function(e,t){return e.itemType-t.itemType}))}},select(){var e=this;e.doSelect=!e.doSelect,e.controlShow=!e.controlShow},selectItem(e){this.doSelect&&(e.choose=!e.choose)},goBag(){e.index.navigateTo({url:"/pages/category/bag"})},forceupdate(){this.update=!1,this.update=!0},chooseAll(){var e=this;e.selectAll=!e.selectAll;for(let t=0;t<e.curList.length;t++)0==e.curList[t].deliveryStatus&&(e.curList[t].choose=e.selectAll)},verify(){var t=this;let s=[];for(let e=0;e<t.cabinetList.length;e++)t.cabinetList[e].choose&&s.push(t.cabinetList[e]);return s.length>0||(e.index.showToast({title:"请选择",icon:"none"}),!1)},goPackage(){var t=this;if(this.verify()){for(let e=0;e<t.cabinetList.length;e++)t.cabinetList[e].choose&&t.changeArr.push(t.cabinetList[e].userProductCode);console.log(t.changeArr),e.index.request({url:"http://123.60.71.74:20001/mh/user/product/bag/in?userProductCodeList="+this.changeArr.join(","),method:"PUT",header:{token:this.token,"Content-Type":"application/x-www-form-urlencoded"},success:e=>{console.log(e),this.$nextTick((function(){t.$emit("update")}))}}),this.complete()}console.log("放进背包",this.changeArr),this.changeArr=[]},goDeal(){var t=this;if(this.verify()){for(let e=0;e<t.curList.length;e++)t.curList[e].choose&&(t.curList[e].isdeal=!0,t.curList[e].choose=!1,t.changeArr.push(t.curList[e]));this.complete(),console.log("发布交易",this.changeArr),e.index.navigateTo({url:"/pages/category/publish"})}this.changeArr=[]},goRecover(){var e=this;if(e.changeArr=[],this.verify()){e.$refs.recover.open("bottom");var t=0;for(let s=0;s<e.curList.length;s++)e.curList[s].choose&&(e.curList[s].readyRecover=1,t+=Number(e.curList[s].recoverPrice),e.changeArr.push(e.curList[s].userProductCode));e.recoverPoint=t,this.complete()}},closeRecover(){for(let e=0;e<this.curList.length;e++)this.curList[e].flagRecovery=0},confirmRecover(){var t=this;e.index.request({url:"http://123.60.71.74:20001/mh/user/product/recover?userProductCodeList="+this.changeArr.join(","),method:"PUT",header:{"Content-Type":"application/x-www-form-urlencoded",token:this.token},success:e=>{console.log(e)}}),this.$refs.recover.close(),this.$emit("update"),this.$nextTick((function(){t.$emit("update")}))},goShip(){var e=this;if(this.getAddress(),this.verify()){e.$refs.ship.open("bottom");var t=0;for(let s=0;s<e.cabinetList.length;s++)e.cabinetList[s].choose&&(e.cabinetList[s].deliveryStatus=11,t++);e.products=t,this.complete()}},closeShip(){var e=this;for(let t=0;t<e.cabinetList.length;t++)11==e.cabinetList[t].deliveryStatus&&(e.cabinetList[t].deliveryStatus=0)},checkShip(){var e=[];this.cabinetList.forEach((t=>{t.choose&&e.push(t)})),e.forEach((e=>{for(;e.flagPreSale;){this.hasPre=!0,this.msgContent="预售商品不可申请发货！";break}})),this.$refs.alert.open("center")},confirmShip(){var t=this,s=[];for(let e=0;e<t.cabinetList.length;e++)t.cabinetList[e].choose&&(t.cabinetList[e].deliveryStatus=1,s.push(t.cabinetList[e].userProductCode),t.cabinetList[e].choose=!1);t.applyShip=s,console.log("确认申请",t.applyShip),e.index.request({url:"http://123.60.71.74:20001/mh/user/product/delivery/apply?userProductCodeList="+this.applyShip.join(","),method:"PUT",header:{token:this.token,"Content-Type":"application/x-www-form-urlencoded"},success:e=>{console.log(e),this.$nextTick((function(){t.$emit("update")}))}}),t.$refs.ship.close()},toAddress(){this.$refs.ship.close(),this.$refs.addressList.open("bottom")},complete(){this.doSelect=!1,this.controlShow=!1,this.selectAll=!1},newAddress(){e.index.navigateTo({url:"/pages/user/address"})},confirmAddress(){this.$refs.addressList.close(),this.$refs.ship.open("bottom")},addressClick(e){var t=this;this.addressList.forEach((function(s){s.active=!1,t.addressList[e].active=!0})),this.address=this.addressList[e]},loadClass(){var e=this.cabinetList,t=this,s=[];e.forEach((function(e){10!=e.productItemPosition||e.flagRecovery||s.push(e)}));var o=[];for(let a=0;a<s.length;a++){var c=new Object;c.name=s[a].class1Name,c.class1Code=s[a].class1Code,c.choose=!1,c.class="c1",c.list=[],o.push(c),t.checkRepeat(o);for(let e=0;e<s.length;e++){var i=new Object;i.name=s[e].class2Name,i.class2Code=s[e].class2Code,i.choose=!1,i.class="c2",i.list=[],s[a].class1Code==s[e].class1Code&&c.list.push(i),t.checkRepeat(c.list);for(let o=0;o<s.length;o++){var r=new Object;r.name=s[o].class3Name,r.class3Code=s[o].class3Code,r.class="c3",r.choose=!1,s[e].class2Code==s[o].class2Code&&i.list.push(r),t.checkRepeat(i.list)}}}console.log(o),this.classAll=o},checkRepeat(e){for(let t=0;t<e.length;t++)for(let s=t+1;s<e.length;s++)e[t].name===e[s].name&&(e.splice(s,1),s--)},loadMore(t){var s=this;this.pageNo<this.totalPage?(s.pageNo++,this.status="loading",e.index.request({url:"http://123.60.71.74:20001/mh/user/product/page",method:"GET",dataType:"JSON",header:{token:s.token},data:{no:s.pageNo,size:10},success:e=>{JSON.parse(e.data).data.list.forEach((function(e){s.cabinetList.push(e),s.curList.push(e)})),s.status="more"}})):this.status="noMore"},getAddress(){e.index.request({url:"http://123.60.71.74:20001//mh/user/address/list",method:"GET",dataType:"JSON",header:{token:this.token},success:e=>{let t=JSON.parse(e.data);this.addressList=t.data,console.log(this.addressList),this.address=this.addressList[0]}})},imgPreview(t){const s=[];s.push(t.imgUrl),this.doSelect||e.index.previewImage({urls:s})}},mounted(){1==this.totalPage&&(this.status="noMore")},watch:{getData:function(e,t){console.log("列表更新",e),this.cabinetList=[],this.cabinetList=this.cabinetList.concat(e),this.curList=[],this.curList=this.curList.concat(e),this.forceupdate(),this.curList.sort((function(e,t){return e.itemType-t.itemType}))},cabinetList:function(e){this.loadClass()},pageIndex:function(e){this.doSelect=!1}}};if(!Array){(e.resolveComponent("uni-segmented-control")+e.resolveComponent("uni-drawer")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-segmented-control/components/uni-segmented-control/uni-segmented-control.js")+(()=>"../../uni_modules/uni-drawer/components/uni-drawer/uni-drawer.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();var s=e._export_sfc(t,[["render",function(t,s,o,c,i,r){return e.e({a:!i.hasConditions,b:i.hasConditions,c:e.o(((...e)=>r.showAll&&r.showAll(...e))),d:i.small?1:"",e:i.timeImg[i.timeIndex],f:e.o(((...e)=>r.timeSwitch&&r.timeSwitch(...e))),g:0==o.pageIndex},0==o.pageIndex?{h:!i.doSelect,i:!i.doSelect,j:!i.doSelect,k:i.doSelect,l:e.o(((...e)=>r.select&&r.select(...e)))}:{},{m:0!=o.pageIndex},(o.pageIndex,{}),{n:e.o(r.onClickItem),o:e.p({current:i.current,values:i.items,"style-type":i.styleType,"active-color":i.activeColor}),p:0===i.current},0===i.current?{q:e.f(i.curList,((t,s,c)=>({a:t.imgUrl,b:e.o((e=>r.imgPreview(t))),c:e.t(t.itemTypeName),d:e.t(t.productItemName),e:i.doSelect&&t.choose,f:t.flagPreSale,g:s,h:e.o((e=>r.selectItem(t)),s),i:(t.deliveryStatus==o.pageIndex||11==t.deliveryStatus)&&10==t.productItemPosition&&0==t.flagRecovery})))}:{},{r:1===i.current},1===i.current?{s:e.f(i.curList,((t,s,c)=>({a:t.imgUrl,b:e.o((e=>r.imgPreview(t))),c:e.t(t.itemTypeName),d:e.t(t.productItemName),e:i.doSelect&&t.choose,f:s,g:e.o((e=>r.selectItem(t)),s),h:(t.deliveryStatus==o.pageIndex||11==t.deliveryStatus)&&0==t.flagPreSale&&10==t.productItemPosition&&0==t.flagRecovery})))}:{},{t:2===i.current},2===i.current?{v:e.f(i.curList,((t,s,c)=>({a:t.imgUrl,b:e.o((e=>r.imgPreview(t))),c:e.t(t.itemTypeName),d:e.t(t.productItemName),e:i.doSelect&&t.choose,f:s,g:e.o((e=>r.selectItem(t)),s),h:(t.deliveryStatus==o.pageIndex||11==t.deliveryStatus)&&1==t.flagPreSale&&10==t.productItemPosition&&0==t.flagRecovery})))}:{},{w:3===i.current},3===i.current?{x:e.f(i.curList,((t,s,c)=>({a:t.imgUrl,b:e.o((e=>r.imgPreview(t))),c:e.t(t.itemTypeName),d:e.t(t.productItemName),e:i.doSelect&&t.choose,f:t.flagPreSale,g:s,h:e.o((e=>r.selectItem(t)),s),i:(t.deliveryStatus==o.pageIndex||11==t.deliveryStatus)&&1==t.flagSingle&&10==t.productItemPosition&&0==t.flagRecovery})))}:{},{y:i.update,z:e.o(((...e)=>r.goBag&&r.goBag(...e))),A:i.showBag&&!i.doSelect,B:e.o(((...e)=>r.clickAll&&r.clickAll(...e))),C:e.f(i.classAll,((t,s,o)=>e.e({a:e.t(t.name),b:!t.choose},(t.choose,{}),{c:t.choose},(t.choose,{}),{d:t.choose?1:"",e:e.o((e=>r.classChoose(t,s))),f:e.f(t.list,((t,s,o)=>e.e({a:e.t(t.name),b:!t.choose},(t.choose,{}),{c:t.choose},(t.choose,{}),{d:t.choose?1:"",e:e.o((e=>r.classChoose(t,s))),f:e.f(t.list,((t,s,o)=>({a:e.t(t.name),b:t.choose?1:"",c:e.o((e=>r.classChoose(t,s))),d:s}))),g:s,h:t.choose?"1000rpx":"80rpx"}))),g:s,h:t.choose?"1000rpx":"80rpx"}))),D:e.o(((...e)=>r.submit&&r.submit(...e))),E:e.sr("allPros","45a94da2-1"),F:e.o((e=>r.closeAll())),G:e.p({mode:"left","mask-click":!0}),H:i.selectAll,I:e.o(((...e)=>r.chooseAll&&r.chooseAll(...e))),J:e.o((e=>r.goDeal())),K:e.o((e=>r.goRecover())),L:e.o((e=>r.goShip())),M:i.controlShow,N:e.f(i.curList,((t,s,o)=>({a:t.imgUrl,b:e.t(t.productItemName),c:e.t(t.recoverPrice),d:s,e:0==t.deliveryStatus&&1==t.readyRecover}))),O:e.t(i.recoverPoint),P:e.o(((...e)=>r.confirmRecover&&r.confirmRecover(...e))),Q:e.sr("recover","45a94da2-2"),R:e.o(r.closeRecover),S:e.p({type:"bottom"}),T:e.t(i.address.customerName),U:e.t(i.address.phone),V:e.t(i.address.province),W:e.t(i.address.city),X:e.t(i.address.area),Y:e.t(i.address.detail),Z:e.o(((...e)=>r.toAddress&&r.toAddress(...e))),aa:e.f(i.cabinetList,((t,s,o)=>({a:t.imgUrl,b:e.t(t.productItemName),c:e.t(t.price),d:s,e:11==t.deliveryStatus&&t.choose}))),ab:e.t(i.products),ac:e.o(((...e)=>r.checkShip&&r.checkShip(...e))),ad:e.sr("ship","45a94da2-3"),ae:e.o(r.closeShip),af:e.p({type:"bottom"}),ag:e.f(i.addressList,((t,s,o)=>({a:e.t(t.customerName),b:e.t(t.phone),c:t.flagDefault,d:e.t(t.province),e:e.t(t.city),f:e.t(t.area),g:e.t(t.detail),h:s,i:e.o((e=>r.addressClick(s)),s),j:t.active?1:""}))),ah:e.o(((...e)=>r.newAddress&&r.newAddress(...e))),ai:e.o(((...e)=>r.confirmAddress&&r.confirmAddress(...e))),aj:e.sr("addressList","45a94da2-4"),ak:e.o(r.closeShip),al:e.p({type:"bottom"}),am:e.t(i.msgTitle),an:e.t(i.msgContent),ao:!i.hasPre},i.hasPre?{}:{ap:e.o(((...e)=>r.confirmShip&&r.confirmShip(...e)))},{aq:i.hasPre},i.hasPre?{ar:e.o(((...e)=>t.alertClose&&t.alertClose(...e)))}:{},{as:e.sr("alert","45a94da2-5"),at:e.p({type:"center"})})}]]);wx.createComponent(s);
